(()=>{var a={};a.id=435,a.ids=[435],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},709:a=>{var b=Object.defineProperty,c=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,e=Object.prototype.hasOwnProperty,f={};((a,c)=>{for(var d in c)b(a,d,{get:c[d],enumerable:!0})})(f,{EventSourceParserStream:()=>h}),a.exports=((a,f,g,h)=>{if(f&&"object"==typeof f||"function"==typeof f)for(let g of d(f))e.call(a,g)||void 0===g||b(a,g,{get:()=>f[g],enumerable:!(h=c(f,g))||h.enumerable});return a})(b({},"__esModule",{value:!0}),f);var g=[239,187,191],h=class extends TransformStream{constructor(){let a;super({start(b){a=function(a){let b,c,d,e,f,h,i;return j(),{feed:function(j){var k;c=c?c+j:j,b&&(k=c,g.every((a,b)=>k.charCodeAt(b)===a))&&(c=c.slice(g.length)),b=!1;let l=c.length,m=0,n=!1;for(;m<l;){let b;n&&("\n"===c[m]&&++m,n=!1);let g=-1,j=e;for(let a=d;g<0&&a<l;++a)":"===(b=c[a])&&j<0?j=a-m:"\r"===b?(n=!0,g=a-m):"\n"===b&&(g=a-m);if(g<0){d=l-m,e=j;break}d=0,e=-1,function(b,c,d,e){if(0===e){i.length>0&&(a({type:"event",id:f,event:h||void 0,data:i.slice(0,-1)}),i="",f=void 0),h=void 0;return}let g=d<0,j=b.slice(c,c+(g?e:d)),k=0;k=g?e:" "===b[c+d+1]?d+2:d+1;let l=c+k,m=e-k,n=b.slice(l,l+m).toString();if("data"===j)i+=n?"".concat(n,"\n"):"\n";else if("event"===j)h=n;else if("id"!==j||n.includes("\0")){if("retry"===j){let b=parseInt(n,10);Number.isNaN(b)||a({type:"reconnect-interval",value:b})}}else f=n}(c,m,j,g),m+=g+1}m===l?c="":m>0&&(c=c.slice(m))},reset:j};function j(){b=!0,c="",d=0,e=-1,f=void 0,h=void 0,i=""}}(a=>{"event"===a.type&&b.enqueue(a)})},transform(b){a.feed(b)}})}}},740:(a,b,c)=>{let d=c(1208),{create:e}=c(4269);async function f(a,b,c){var d;let e=new TextEncoder,f=await c.subtle.importKey("raw",(d=a,Uint8Array.from(atob(d),a=>a.codePointAt(0))),{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return g(await c.subtle.sign("HMAC",f,e.encode(b)))}function g(a){return btoa(String.fromCharCode.apply(null,new Uint8Array(a)))}async function h(a,b){return await j(b,async b=>b instanceof Blob||b instanceof Buffer?(await e.call(a,b)).urls.get:b)}async function i(a){let b=0;return await j(a,async a=>{let c,d;if(a instanceof Blob)c=await a.arrayBuffer(),d=a.type;else{if(!k(a))return a;c=a}if((b+=c.byteLength)>1e7)throw Error(`Combined filesize of prediction ${b} bytes exceeds 10mb limit for inline encoding, please provide URLs instead`);let e=g(c);return d=d||"application/octet-stream",`data:${d};base64,${e}`})}async function j(a,b){if(Array.isArray(a)){let c=[];for(let d of a){let a=await j(d,b);c.push(a)}return c}if(function(a){if("object"!=typeof a||null===a||"[object Object]"!==String(a))return!1;let b=Object.getPrototypeOf(a);if(null===b)return!0;let c=Object.prototype.hasOwnProperty.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&Function.prototype.toString.call(c)===Function.prototype.toString.call(Object)}(a)){let c={};for(let d of Object.keys(a))c[d]=await j(a[d],b);return c}return await b(a)}function k(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array}a.exports={transform:j,transformFileInputs:async function a(a,b,c){switch(c){case"data-uri":return await i(a,b);case"upload":return await h(a,b);case"default":try{return await h(a,b)}catch(a){if(a instanceof d&&a.response.status>=400&&a.response.status<500)throw a;return await i(b)}default:throw Error(`Unexpected file upload strategy: ${c}`)}},validateWebhook:async function a(a,b,c){let d,e,g,h,i,j=globalThis.crypto;if(a&&a.headers&&a.body){if("function"==typeof a.headers.get?(d=a.headers.get("webhook-id"),g=a.headers.get("webhook-timestamp"),h=a.headers.get("webhook-signature")):(d=a.headers["webhook-id"],g=a.headers["webhook-timestamp"],h=a.headers["webhook-signature"]),e=a.body,"string"!=typeof b)throw Error("Unexpected value for secret passed to validateWebhook, expected a string");i=b,c&&(j=c)}else d=a.id,e=a.body,g=a.timestamp,h=a.signature,i=a.secret,b&&(j=b);if(e instanceof ReadableStream||e.readable)try{e=await new Response(e).text()}catch(a){throw Error(`Error reading body: ${a.message}`)}else if(k(e))e=await new Blob([e]).text();else if("object"==typeof e)e=JSON.stringify(e);else if("string"!=typeof e)throw Error("Invalid body type");if(!d||!g||!h)throw Error("Missing required webhook headers");if(!e)throw Error("Missing required body");if(!i)throw Error("Missing required secret");if(!j)throw Error('Missing `crypto` implementation. If using Node 18 pass in require("node:crypto").webcrypto');let l=`${d}.${g}.${e}`,m=await f(i.split("_").pop(),l,j);return h.split(" ").map(a=>a.split(",")[1]).some(a=>a===m)},withAutomaticRetries:async function a(b,c={}){let e=c.shouldRetry||(()=>!1),f=c.maxRetries||5,g=c.interval||500,h=c.jitter||100,i=a=>new Promise(b=>setTimeout(b,a)),j=0;do{let a=g*2**j+Math.random()*h;try{let a=await b();if(a.ok||!e(a))return a}catch(b){if(b instanceof d){let c=b.response.headers.get("Retry-After");if(c)if(Number.isInteger(c))a=1e3*c;else{let b=new Date(c);Number.isNaN(b.getTime())||(a=b.getTime()-new Date().getTime())}}}Number.isInteger(f)&&f>0&&(Number.isInteger(a)&&a>0&&await i(g*2**(c.maxRetries-f)),j+=1)}while(j<f);return b()},parseProgressFromLogs:function(a){let b="object"==typeof a&&a.logs?a.logs:a;if(!b||"string"!=typeof b)return null;let c=/^\s*(\d+)%\s*\|.+?\|\s*(\d+)\/(\d+)/;for(let a of b.split("\n").reverse()){let b=a.match(c);if(b&&4===b.length)return{percentage:parseInt(b[1],10)/100,current:parseInt(b[2],10),total:parseInt(b[3],10)}}return null},streamAsyncIterator:async function*(a){let b=a.getReader();try{for(;;){let{done:a,value:c}=await b.read();if(a)return;yield c}}finally{b.releaseLock()}}}},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1208:a=>{class b extends Error{constructor(a,b,c){super(a),this.name="ApiError",this.request=b,this.response=c}}a.exports=b},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3230:a=>{a.exports={get:async function(a,b,{signal:c}={}){return(await this.request(`/models/${a}/${b}`,{method:"GET",signal:c})).json()},list:async function({signal:a}={}){return(await this.request("/models",{method:"GET",signal:a})).json()},create:async function(a,b,c){let{signal:d,...e}=c,f={owner:a,name:b,...e};return(await this.request("/models",{method:"POST",data:f,signal:d})).json()},versions:{list:async function(a,b,{signal:c}={}){return(await this.request(`/models/${a}/${b}/versions`,{method:"GET",signal:c})).json()},get:async function(a,b,c,{signal:d}={}){return(await this.request(`/models/${a}/${b}/versions/${c}`,{method:"GET",signal:d})).json()}},search:async function(a,{signal:b}={}){return(await this.request("/models",{method:"QUERY",headers:{"Content-Type":"text/plain"},data:a,signal:b})).json()}}},3410:(a,b,c)=>{let{transformFileInputs:d}=c(740);a.exports={predictions:{create:async function(a,b,c){let{input:e,wait:f,signal:g,...h}=c;if(h.webhook)try{new URL(h.webhook)}catch(a){throw Error("Invalid webhook URL")}let i={};if(f)if("number"==typeof f){let a=Math.max(1,Math.ceil(Number(f))||1);i.Prefer=`wait=${a}`}else i.Prefer="wait";return(await this.request(`/deployments/${a}/${b}/predictions`,{method:"POST",headers:i,data:{...h,input:await d(this,e,this.fileEncodingStrategy)},signal:g})).json()}},get:async function(a,b,{signal:c}={}){return(await this.request(`/deployments/${a}/${b}`,{method:"GET",signal:c})).json()},create:async function(a,{signal:b}={}){return(await this.request("/deployments",{method:"POST",data:a,signal:b})).json()},update:async function(a,b,c,{signal:d}={}){return(await this.request(`/deployments/${a}/${b}`,{method:"PATCH",data:c,signal:d})).json()},list:async function({signal:a}={}){return(await this.request("/deployments",{method:"GET",signal:a})).json()},delete:async function(a,b,{signal:c}={}){return 204===(await this.request(`/deployments/${a}/${b}`,{method:"DELETE",signal:c})).status}}},3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(1237),e=c(5088),f=c(7679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},3762:a=>{a.exports={default:{secret:{get:async function({signal:a}={}){return(await this.request("/webhooks/default/secret",{method:"GET",signal:a})).json()}}}}},3851:a=>{a.exports={get:async function(a,{signal:b}={}){return(await this.request(`/collections/${a}`,{method:"GET",signal:b})).json()},list:async function({signal:a}={}){return(await this.request("/collections",{method:"GET",signal:a})).json()}}},4011:a=>{"use strict";a.exports=JSON.parse('{"name":"replicate","version":"1.3.0","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","type":"commonjs","types":"index.d.ts","files":["CONTRIBUTING.md","LICENSE","README.md","index.d.ts","index.js","lib/**/*.js","vendor/**/*","package.json"],"engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","format":"biome format . --write","lint-biome":"biome lint .","lint-publint":"publint","lint":"npm run lint-biome && npm run lint-publint","test":"jest"},"optionalDependencies":{"readable-stream":">=4.0.0"},"devDependencies":{"@biomejs/biome":"^1.4.1","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","jest":"^29.7.0","nock":"^14.0.0-beta.6","publint":"^0.2.7","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')},4269:a=>{a.exports={create:async function(a,b={},{signal:c}={}){let d,e,f=new FormData;if(a instanceof Blob)d=a.name||`blob_${Date.now()}`,e=a;else if(Buffer.isBuffer(a))d=`buffer_${Date.now()}`,e=new Blob([new Uint8Array(a)],{type:"application/octet-stream",name:d});else throw Error("Invalid file argument, must be a Blob, File or Buffer");return f.append("content",e,d),f.append("metadata",new Blob([JSON.stringify(b)],{type:"application/json"})),(await this.request("/files",{method:"POST",data:f,headers:{"Content-Type":"multipart/form-data"},signal:c})).json()},list:async function({signal:a}={}){return(await this.request("/files",{method:"GET",signal:a})).json()},get:async function(a,{signal:b}={}){return(await this.request(`/files/${a}`,{method:"GET",signal:b})).json()},delete:async function(a,{signal:b}={}){return 204===(await this.request(`/files/${a}`,{method:"DELETE",signal:b})).status}}},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5272:a=>{a.exports={list:async function({signal:a}={}){return(await this.request("/hardware",{method:"GET",signal:a})).json()}}},5736:(a,b,c)=>{"use strict";a.exports=c(4870)},6268:a=>{var b=Object.defineProperty,c=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,e=Object.prototype.hasOwnProperty,f={};((a,c)=>{for(var d in c)b(a,d,{get:c[d],enumerable:!0})})(f,{TextDecoderStream:()=>j}),a.exports=((a,f,g,h)=>{if(f&&"object"==typeof f||"function"==typeof f)for(let g of d(f))e.call(a,g)||void 0===g||b(a,g,{get:()=>f[g],enumerable:!(h=c(f,g))||h.enumerable});return a})(b({},"__esModule",{value:!0}),f);var g=Symbol("decDecoder"),h=Symbol("decTransform"),i=class{constructor(a){this.decoder_=a}transform(a,b){if(!(a instanceof ArrayBuffer||ArrayBuffer.isView(a)))throw TypeError("Input data must be a BufferSource");let c=this.decoder_.decode(a,{stream:!0});0!==c.length&&b.enqueue(c)}flush(a){let b=this.decoder_.decode();0!==b.length&&a.enqueue(b)}},j=class{constructor(a,b){let c=new TextDecoder(a||"utf-8",b||{});this[g]=c,this[h]=new TransformStream(new i(c))}get encoding(){return this[g].encoding}get fatal(){return this[g].fatal}get ignoreBOM(){return this[g].ignoreBOM}get readable(){return this[h].readable}get writable(){return this[h].writable}};Symbol("encEncoder"),Symbol("encTransform")},6308:a=>{a.exports={current:async function({signal:a}={}){return(await this.request("/account",{method:"GET",signal:a})).json()}}},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},7723:a=>{class b{constructor(a,b,c=null){this.owner=a,this.name=b,this.version=c}static parse(a){let c=a.match(/^(?<owner>[^/]+)\/(?<name>[^/:]+)(:(?<version>.+))?$/);if(!c)throw Error(`Invalid reference to model version: ${a}. Expected format: owner/name or owner/name:version`);let{owner:d,name:e,version:f}=c.groups;return new b(d,e,f)}}a.exports=b},7786:(a,b,c)=>{let d=c(1208),e=c(7723),{createReadableStream:f,createFileOutput:g}=c(8747),{transform:h,withAutomaticRetries:i,validateWebhook:j,parseProgressFromLogs:k,streamAsyncIterator:l}=c(740),m=c(6308),n=c(3851),o=c(3410),p=c(4269),q=c(5272),r=c(3230),s=c(8768),t=c(8285),u=c(3762),v=c(4011);class w{constructor(a={}){this.auth=a.auth||("undefined"!=typeof process?process.env.REPLICATE_API_TOKEN:null),this.userAgent=a.userAgent||`replicate-javascript/${v.version}`,this.baseUrl=a.baseUrl||"https://api.replicate.com/v1",this.fetch=a.fetch||globalThis.fetch,this.fileEncodingStrategy=a.fileEncodingStrategy||"default",this.useFileOutput=!1!==a.useFileOutput,this.accounts={current:m.current.bind(this)},this.collections={list:n.list.bind(this),get:n.get.bind(this)},this.deployments={get:o.get.bind(this),create:o.create.bind(this),update:o.update.bind(this),delete:o.delete.bind(this),list:o.list.bind(this),predictions:{create:o.predictions.create.bind(this)}},this.files={create:p.create.bind(this),get:p.get.bind(this),list:p.list.bind(this),delete:p.delete.bind(this)},this.hardware={list:q.list.bind(this)},this.models={get:r.get.bind(this),list:r.list.bind(this),create:r.create.bind(this),versions:{list:r.versions.list.bind(this),get:r.versions.get.bind(this)},search:r.search.bind(this)},this.predictions={create:s.create.bind(this),get:s.get.bind(this),cancel:s.cancel.bind(this),list:s.list.bind(this)},this.trainings={create:t.create.bind(this),get:t.get.bind(this),cancel:t.cancel.bind(this),list:t.list.bind(this)},this.webhooks={default:{secret:{get:u.default.secret.get.bind(this)}}}}async run(a,b,c){let d,{wait:f={mode:"block"},signal:i,...j}=b,k=e.parse(a);if(k.version)d=await this.predictions.create({...j,version:k.version,wait:"block"===f.mode&&(f.timeout??!0)});else if(k.owner&&k.name)d=await this.predictions.create({...j,model:`${k.owner}/${k.name}`,wait:"block"===f.mode&&(f.timeout??!0)});else throw Error("Invalid model version identifier");if(c&&c(d),("block"!==f.mode||"starting"===d.status)&&(d=await this.wait(d,{interval:"poll"===f.mode?f.interval:void 0},async a=>(c&&c(a),!!i&&!!i.aborted))),i&&i.aborted&&(d=await this.predictions.cancel(d.id)),c&&c(d),"failed"===d.status)throw Error(`Prediction failed: ${d.error}`);return h(d.output,a=>"string"==typeof a&&(a.startsWith("https:")||a.startsWith("data:"))&&this.useFileOutput?g({url:a,fetch:this.fetch}):a)}async request(a,b){let c,e,{auth:f,baseUrl:g,userAgent:h}=this;c=a instanceof URL?a:new URL(a.startsWith("/")?a.slice(1):a,g.endsWith("/")?g:`${g}/`);let{method:j="GET",params:k={},data:l,signal:m}=b;for(let[a,b]of Object.entries(k))c.searchParams.append(a,b);let n={"Content-Type":"application/json","User-Agent":h};if(f&&(n.Authorization=`Bearer ${f}`),b.headers)for(let[a,c]of Object.entries(b.headers))n[a]=c;l instanceof FormData?(e=l,delete n["Content-Type"]):l&&(e=JSON.stringify(l));let o={method:j,headers:n,body:e,signal:m},p="GET"===j?a=>429===a.status||a.status>=500:a=>429===a.status,q=this.fetch,r=await i(async()=>q(c,o),{shouldRetry:p});if(!r.ok){let a=new Request(c,o),b=await r.text();throw new d(`Request to ${c} failed with status ${r.status} ${r.statusText}: ${b}.`,a,r)}return r}async *stream(a,b){let c,{wait:d,signal:g,...h}=b,i=e.parse(a);if(i.version)c=await this.predictions.create({...h,version:i.version});else if(i.owner&&i.name)c=await this.predictions.create({...h,model:`${i.owner}/${i.name}`});else throw Error("Invalid model version identifier");if(c.urls&&c.urls.stream){let a=f({url:c.urls.stream,fetch:this.fetch,...g?{options:{signal:g}}:{}});yield*l(a)}else throw Error("Prediction does not support streaming")}async *paginate(a,b={}){let c=await a();if(yield c.results,c.next&&!(b.signal&&b.signal.aborted)){let a=()=>this.request(c.next,{method:"GET",signal:b.signal}).then(a=>a.json());yield*this.paginate(a,b)}}async wait(a,b,c){let{id:d}=a;if(!d)throw Error("Invalid prediction");if("succeeded"===a.status||"failed"===a.status||"canceled"===a.status)return a;let e=a=>new Promise(b=>setTimeout(b,a)),f=b&&b.interval||500,g=await this.predictions.get(d);for(;"succeeded"!==g.status&&"failed"!==g.status&&"canceled"!==g.status&&(!c||await c(g)!==!0);)await e(f),g=await this.predictions.get(a.id);if("failed"===g.status)throw Error(`Prediction failed: ${g.error}`);return g}}a.exports=w,a.exports.validateWebhook=j,a.exports.parseProgressFromLogs=k},8285:a=>{a.exports={create:async function(a,b,c,d){let{signal:e,...f}=d;if(f.webhook)try{new URL(f.webhook)}catch(a){throw Error("Invalid webhook URL")}return(await this.request(`/models/${a}/${b}/versions/${c}/trainings`,{method:"POST",data:f,signal:e})).json()},get:async function(a,{signal:b}={}){return(await this.request(`/trainings/${a}`,{method:"GET",signal:b})).json()},cancel:async function(a,{signal:b}={}){return(await this.request(`/trainings/${a}/cancel`,{method:"POST",signal:b})).json()},list:async function({signal:a}={}){return(await this.request("/trainings",{method:"GET",signal:a})).json()}}},8335:()=>{},8747:(a,b,c)=>{let d=c(1208),{streamAsyncIterator:e}=c(740),{EventSourceParserStream:f}=c(709),{TextDecoderStream:g}=void 0===globalThis.TextDecoderStream?c(6268):globalThis;class h{constructor(a,b,c,d){this.event=a,this.data=b,this.id=c,this.retry=d}toString(){return"output"===this.event?this.data:""}}function i({url:a,fetch:b}){let c="application/octet-stream";class f extends ReadableStream{async blob(){let a=[];for await(let b of this)a.push(b);return new Blob(a,{type:c})}url(){return new URL(a)}toString(){return a}}return new f({async start(f){let g=await b(a);if(!g.ok){let b=await g.text(),c=new Request(a,init);f.error(new d(`Request to ${a} failed with status ${g.status}: ${b}`,c,g))}g.headers.get("Content-Type")&&(c=g.headers.get("Content-Type"));try{for await(let a of e(g.body))f.enqueue(a);f.close()}catch(a){f.error(a)}}})}a.exports={createFileOutput:i,createReadableStream:function({url:a,fetch:b,options:c={}}){let{useFileOutput:j=!0,headers:k={},...l}=c;return new ReadableStream({async start(c){let m={...l,headers:{...k,Accept:"text/event-stream"}},n=await b(a,m);if(!n.ok){let b=await n.text(),e=new Request(a,m);c.error(new d(`Request to ${a} failed with status ${n.status}: ${b}`,e,n))}for await(let a of e(n.body.pipeThrough(new g).pipeThrough(new f))){if("error"===a.event){c.error(Error(a.data));break}let d=a.data;if(j&&"string"==typeof d&&(d.startsWith("https:")||d.startsWith("data:"))&&(d=i({data:d,fetch:b})),c.enqueue(new h(a.event,d,a.id)),"done"===a.event)break}c.close()}})},ServerSentEvent:h}},8768:(a,b,c)=>{let{transformFileInputs:d}=c(740);a.exports={create:async function(a){let b,{model:c,version:e,input:f,wait:g,signal:h,...i}=a;if(i.webhook)try{new URL(i.webhook)}catch(a){throw Error("Invalid webhook URL")}let j={};if(g)if("number"==typeof g){let a=Math.max(1,Math.ceil(Number(g))||1);j.Prefer=`wait=${a}`}else j.Prefer="wait";if(e)b=await this.request("/predictions",{method:"POST",headers:j,data:{...i,input:await d(this,f,this.fileEncodingStrategy),version:e},signal:h});else if(c)b=await this.request(`/models/${c}/predictions`,{method:"POST",headers:j,data:{...i,input:await d(this,f,this.fileEncodingStrategy)},signal:h});else throw Error("Either model or version must be specified");return b.json()},get:async function(a,{signal:b}={}){return(await this.request(`/predictions/${a}`,{method:"GET",signal:b})).json()},cancel:async function(a,{signal:b}={}){return(await this.request(`/predictions/${a}/cancel`,{method:"POST",signal:b})).json()},list:async function({signal:a}={}){return(await this.request("/predictions",{method:"GET",signal:a})).json()}}},8788:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>C,patchFetch:()=>B,routeModule:()=>x,serverHooks:()=>A,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>z});var d={};c.r(d),c.d(d,{POST:()=>w});var e=c(5736),f=c(9117),g=c(4044),h=c(9326),i=c(2324),j=c(261),k=c(4290),l=c(5328),m=c(8928),n=c(6595),o=c(3421),p=c(7679),q=c(1681),r=c(3446),s=c(6439),t=c(1356),u=c(7786);let v=new(c.n(u)())({auth:process.env.REPLICATE_API_TOKEN});async function w(a){try{let b,{prompt:c}=await a.json();if(!c)return Response.json({error:"Prompt is required"},{status:400});if(console.log("=== ENVIRONMENT DIAGNOSTICS ==="),console.log("REPLICATE_API_TOKEN exists:",!!process.env.REPLICATE_API_TOKEN),console.log("REPLICATE_API_TOKEN length:",process.env.REPLICATE_API_TOKEN?.length||0),console.log("REPLICATE_API_TOKEN starts with:",process.env.REPLICATE_API_TOKEN?.substring(0,10)||"N/A"),console.log("NODE_ENV:","production"),console.log("VERCEL:",process.env.VERCEL),console.log("Available env vars with REPLICATE:",Object.keys(process.env).filter(a=>a.includes("REPLICATE"))),!process.env.REPLICATE_API_TOKEN)return console.error("REPLICATE_API_TOKEN is not set"),console.error("Available env vars:",Object.keys(process.env).filter(a=>a.includes("REPLICATE"))),Response.json({error:"API token not configured. Please set REPLICATE_API_TOKEN in your .env.local file."},{status:500});console.log("=== Starting image generation ==="),console.log("Prompt:",`dccomic ${c}`),console.log("API Token exists:",!!process.env.REPLICATE_API_TOKEN),console.log("API Token length:",process.env.REPLICATE_API_TOKEN?.length||0);try{console.log("=== REPLICATE API CALL DIAGNOSTICS ==="),console.log("Attempting predictions.create with model:","resilientcoders/calvin-comic-cover:5e26874f460dbb4e0a13e468d9c6e6bebcaf91962a78eea2b88e96bd3d4c9fef"),console.log("Input prompt:",`dccomic ${c}`);let a=await v.predictions.create({model:"resilientcoders/calvin-comic-cover:5e26874f460dbb4e0a13e468d9c6e6bebcaf91962a78eea2b88e96bd3d4c9fef",input:{prompt:`dccomic ${c}`}});console.log("Prediction created successfully:",a.id),console.log("Prediction status:",a.status),console.log("Prediction object keys:",Object.keys(a)),console.log("Waiting for prediction to complete..."),b=await v.wait(a),console.log("Prediction completed successfully"),console.log("Output type:",typeof b),console.log("Output constructor:",b?.constructor?.name)}catch(a){console.error("=== REPLICATE API ERROR DIAGNOSTICS ==="),console.error("Error type:",typeof a),console.error("Error constructor:",a?.constructor?.name),console.error("Error message:",a instanceof Error?a.message:String(a)),console.error("Error stack:",a instanceof Error?a.stack:"No stack trace"),console.error("Full error object:",JSON.stringify(a,null,2));try{console.log("=== FALLBACK REPLICATE.RUN DIAGNOSTICS ==="),console.log("Trying fallback replicate.run approach..."),console.log("Model:","resilientcoders/calvin-comic-cover:5e26874f460dbb4e0a13e468d9c6e6bebcaf91962a78eea2b88e96bd3d4c9fef"),console.log("Input:",{prompt:`dccomic ${c}`}),b=await v.run("resilientcoders/calvin-comic-cover:5e26874f460dbb4e0a13e468d9c6e6bebcaf91962a78eea2b88e96bd3d4c9fef",{input:{prompt:`dccomic ${c}`}}),console.log("Fallback replicate.run succeeded"),console.log("Fallback output type:",typeof b),console.log("Fallback output constructor:",b?.constructor?.name)}catch(b){throw console.error("=== FALLBACK ERROR DIAGNOSTICS ==="),console.error("Fallback error type:",typeof b),console.error("Fallback error constructor:",b?.constructor?.name),console.error("Fallback error message:",b instanceof Error?b.message:String(b)),console.error("Fallback error stack:",b instanceof Error?b.stack:"No stack trace"),console.error("Full fallback error object:",JSON.stringify(b,null,2)),Error(`Replicate API error: ${a instanceof Error?a.message:"Unknown error"}`)}}console.log("=== Raw Replicate Response ==="),console.log("Output:",b),console.log("Output type:",typeof b),console.log("Output constructor:",b?.constructor?.name),console.log("Is ReadableStream?",b instanceof ReadableStream),console.log("Is Array?",Array.isArray(b)),console.log("Is Object?",b&&"object"==typeof b),console.log("Output keys:",b&&"object"==typeof b?Object.keys(b):"N/A");let d=null;if(b instanceof ReadableStream){console.log("=== Processing ReadableStream ===");try{let a=b.getReader(),c=[],e=!1;for(;!e;){let{value:b,done:d}=await a.read();b&&c.push(b),e=d}let f=c.reduce((a,b)=>a+b.length,0),g=new Uint8Array(f),h=0;for(let a of c)g.set(a,h),h+=a.length;console.log("Combined array length:",g.length),console.log("First 20 bytes:",Array.from(g.slice(0,20)).map(a=>a.toString(16).padStart(2,"0")).join(" ")),console.log("Last 20 bytes:",Array.from(g.slice(-20)).map(a=>a.toString(16).padStart(2,"0")).join(" "));let i=g.length>1e3&&g.some(a=>a<32&&9!==a&&10!==a&&13!==a);if(console.log("Is binary data:",i),i){console.log("=== Converting binary image data to base64 ===");let a=Buffer.from(g).toString("base64"),b="image/png";255===g[0]&&216===g[1]&&255===g[2]?b="image/jpeg":137===g[0]&&80===g[1]&&78===g[2]&&71===g[3]?b="image/png":71===g[0]&&73===g[1]&&70===g[2]?b="image/gif":82===g[0]&&73===g[1]&&70===g[2]&&70===g[3]&&(b="image/webp"),console.log("Detected image type:",b),console.log("Base64 data length:",a.length),d=`data:${b};base64,${a}`,console.log("Created data URL with type:",b),console.log("Data URL length:",d.length)}else try{let a=new TextDecoder().decode(g),b=JSON.parse(a);console.log("Parsed JSON from stream:",b),d=b.output?.[0]||b.data?.[0]||b.url||b.image||(Array.isArray(b)?b[0]:null)}catch(b){console.log("Not JSON, trying regex extraction..."),console.log("JSON parse error:",b);let a=new TextDecoder().decode(g).match(/https:\/\/replicate\.delivery\/[^\s"']+/);a&&(d=a[0])}}catch(a){throw console.error("Error processing stream:",a),Error(`Stream processing error: ${a instanceof Error?a.message:"Unknown error"}`)}}else if("string"==typeof b)console.log("=== Processing String Output ==="),d=b;else if(Array.isArray(b))if(console.log("=== Processing Array Output ==="),console.log("Array length:",b.length),console.log("First element type:",typeof b[0]),console.log("First element is ReadableStream:",b[0]instanceof ReadableStream),b[0]instanceof ReadableStream){console.log("=== Processing ReadableStream from Array ===");try{let a=b[0].getReader(),c=[],e=!1;for(;!e;){let{value:b,done:d}=await a.read();b&&c.push(b),e=d}let f=c.reduce((a,b)=>a+b.length,0),g=new Uint8Array(f),h=0;for(let a of c)g.set(a,h),h+=a.length;console.log("Combined array length:",g.length),console.log("First 20 bytes:",Array.from(g.slice(0,20)).map(a=>a.toString(16).padStart(2,"0")).join(" ")),console.log("Last 20 bytes:",Array.from(g.slice(-20)).map(a=>a.toString(16).padStart(2,"0")).join(" "));let i=g.length>1e3&&g.some(a=>a<32&&9!==a&&10!==a&&13!==a);if(console.log("Is binary data:",i),i){console.log("=== Converting binary image data to base64 ===");let a=Buffer.from(g).toString("base64"),b="image/png";255===g[0]&&216===g[1]&&255===g[2]?b="image/jpeg":137===g[0]&&80===g[1]&&78===g[2]&&71===g[3]?b="image/png":71===g[0]&&73===g[1]&&70===g[2]?b="image/gif":82===g[0]&&73===g[1]&&70===g[2]&&70===g[3]&&(b="image/webp"),console.log("Detected image type:",b),console.log("Base64 data length:",a.length),d=`data:${b};base64,${a}`,console.log("Created data URL with type:",b),console.log("Data URL length:",d.length)}else try{let a=new TextDecoder().decode(g),b=JSON.parse(a);console.log("Parsed JSON from array stream:",b),d=b.output?.[0]||b.data?.[0]||b.url||b.image||(Array.isArray(b)?b[0]:null)}catch(b){console.log("Not JSON, trying regex extraction from array stream..."),console.log("JSON parse error:",b);let a=new TextDecoder().decode(g);for(let b of[/https:\/\/replicate\.delivery\/[^\s"']+/,/https:\/\/[^\s"']*\.(jpg|jpeg|png|gif|webp)/i,/https:\/\/[^\s"']*replicate[^\s"']*/i]){let c=a.match(b);if(c){console.log("Found URL with pattern:",b,"URL:",c[0]),d=c[0];break}}if(!d){let b=a.match(/https:\/\/[^\s"']+/);b&&(console.log("Found any URL:",b[0]),d=b[0])}}}catch(a){throw console.error("Error processing stream from array:",a),Error(`Stream processing error: ${a instanceof Error?a.message:"Unknown error"}`)}}else d=b[0];else if(b&&"object"==typeof b){console.log("=== Processing Object Output ==="),console.log("Object keys:",Object.keys(b)),console.log("Object values:",Object.values(b));let a=b;d=(Array.isArray(a.output)?a.output[0]:a.output)||(Array.isArray(a.data)?a.data[0]:a.data)||a.url||a.image||a.result||(Array.isArray(a.prediction?.output)?a.prediction.output[0]:a.prediction?.output)||null,Array.isArray(d)&&(d=d[0])}if(console.log("=== URL Extraction Result ==="),console.log("Extracted imageUrl:",d),console.log("ImageUrl type:",typeof d),!d||"string"!=typeof d)throw console.error("=== VALIDATION FAILED ==="),console.error("No valid image URL found"),console.error("Full output for debugging:",JSON.stringify(b,null,2)),Error("Model did not return a valid image URL");let e=d;if(!e.startsWith("http")&&!e.startsWith("data:"))throw console.error("Invalid URL format:",e),Error("Invalid image URL format");return console.log("=== SUCCESS ==="),console.log("Final image URL:",d),Response.json({imageUrl:d})}catch(a){return console.error("=== MAIN ERROR HANDLER DIAGNOSTICS ==="),console.error("Error type:",typeof a),console.error("Error constructor:",a?.constructor?.name),console.error("Error message:",a instanceof Error?a.message:String(a)),console.error("Error stack:",a instanceof Error?a.stack:"No stack trace"),console.error("Full error object:",JSON.stringify(a,null,2)),console.error("Environment at error time:"),console.error("- NODE_ENV:","production"),console.error("- VERCEL:",process.env.VERCEL),console.error("- REPLICATE_API_TOKEN exists:",!!process.env.REPLICATE_API_TOKEN),Response.json({error:a instanceof Error?a.message:"Failed to generate image",details:void 0},{status:500})}}let x=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/generate/route",pathname:"/api/generate",filename:"route",bundlePath:"app/api/generate/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\dev\\comic-cover-app\\app\\api\\generate\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:y,workUnitAsyncStorage:z,serverHooks:A}=x;function B(){return(0,g.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:z})}async function C(a,b,c){var d;let e="/api/generate/route";"/index"===e&&(e="/");let g=await x.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:y,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!y){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||x.isDev||y||(G="/index"===(G=D)?"/":G);let H=!0===x.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>x.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>x.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await x.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await x.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),y&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await x.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[873],()=>b(b.s=8788));module.exports=c})();